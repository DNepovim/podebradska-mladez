extends layouts/default

block content
  | <?php
  | $args = array(
  |   'post_type'  => 'events',
  |   'offset'     => 0,
  |   'order' => 'ASC',
  |   'meta_query' => array(
  |       array(
  |           'key'     => 'pm_end_date',
  |           'value'   => current_time( 'Y-m-d H:i' ),
  |           'compare' => '>',
  |       )
  |   )
  | ); ?>

  - if ($events = get_posts($args)):
    - $event = $events[0]
    main.col-sm-9.col-md-6.invitation
      - if (has_post_thumbnail($event)):
        .invitation__image.box
          a.invitation__link(href= get_the_post_thumbnail_url($event, 'full'))
            - echo get_the_post_thumbnail($event, 'blog', array('class' => 'img-responsive'))
      - else:
        .invitation__image.invitation__image--empty.box
          | <?php
          | $start = strtotime(get_post_meta($event->ID, 'pm_start_date', true));
          | $end = strtotime(get_post_meta($event->ID, 'pm_end_date', true));
          | if(date('m', $start) == date('m', $end)){
          |   $date = date('j.', $start) . ' - ' . date('j. n. Y', $end);
          | } else {
          |   $date = date('j. n.', $start) . ' - ' . date('j. n. Y', $end);
          | }
          | ?>
          h1.invitation__title= $event->post_title
          h2.invitation__subtitle= $date
      - endif
      .invitation__text.text.box
        - echo $event->post_content
    .col-sm-10.col-sm-offset-1.col-md-4.col-md-offset-0
      .map.box
        - $map_post_id = get_post_meta($event->ID,'pm_position',true)
        - echo get_post_meta($map_post_id, 'pm_position', true)

    .col-sm-6.col-sm-offset-3.col-md-3.col-md-offset-0
      - if ($register_to = get_post_meta($event->ID, 'pm_register_to', true)):
        - if ($register_to >= current_time( 'Y-m-d' )):
          .form__text
            = 'Přihlašujte se do ' . date('j. n. Y', strtotime($register_to))
          form#registerForm.form.box(action=bloginfo('template_directory') + '/post-process.php', method='POST')
            input#postID.form__input(type='hidden', name='postID', value='<?php echo $event->ID; ?>')
            label.form__label(for='postName')='Jméno:'
              - if (!empty($_GET['postName'])):
                span.form__error='Jméno musí být vyplněno.'
              - endif
            input#postName.form__input(type='text', name='postName', required='required')

            label.form__label(for='inputSurname')='Příjmení:'
              - if (!empty($_GET['postSurname'])):
                span.form__error='Příjmení musí být vyplněno.'
              - endif
            input#inputSurname.form__input(type='text', name='postSurname', required='required')

            label.form__label(for='inputMail')='E-mail:'
            - if (!empty($_GET['postMail'])):
              span.form__error='E-mail musí být vyplněn.'
            - endif
            input#inputMail.form__input(type='text', name='postMail', required='required')

            input#submitted(type='hidden', name='submitted', value='true')
            - wp_nonce_field( 'post_nonce', 'post_nonce_field' )
            button.button.button.form__button(type='submit')='Přihlásit se'

            - if ($_GET['status'] == 'success'):
              span.form__message.form__message--success= 'Byl jsi úspěšně přihlášen.'
            - elseif ($_GET['status'] == 'error'):
              span.form__message.form__message--error= 'Něco se pokazilo.'
            - endif;
        - else:
          .form__late.box= 'Přihlašování už bylo uzavřeno.'
        - endif
      - else:
        .form__late.box= 'Přihlašování ještě není otevřené.'
      - endif

    - if ($nextEvents = array_slice($events, 1)):
      .col-sm-10.col-sm-offset-1.col-md-5.col-md-offset-4
        .calendar.box
          p.calendar__description='Další akce:'
            .calendar__list
              - foreach ($nextEvents as $item ):
                | <?php
                | $start = strtotime(get_post_meta($item->ID, 'pm_start_date', true));
                | $end = strtotime(get_post_meta($item->ID, 'pm_end_date', true));
                | if(date('m', $start) == date('m', $end)){
                |   $date = date('j.', $start) . ' - ' . date('j. n. Y', $end);
                | } else {
                |   $date = date('j. n.', $start) . ' - ' . date('j. n. Y', $end);
                | }
                | ?>
                .calendar__name=$item->post_title
                .calendar__date=$date
              - endforeach
    - endif
    - wp_reset_query()
  - else:
    main.col-sm-6.invitation
      .invitation__image.invitation__image--empty.box
        h1.invitation__title= 'Nejsou naplánované žádné akce'
        h2.invitation__subtitle= 'Zkus to později'
  - endif

